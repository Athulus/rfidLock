#!/usr/bin/python3

from rfidLock import Door
import json
import serial
import mysql.connector
import sqlite3

# TODO Allow configuring pins and serial communication via JSON
config_path = "/etc/rfidlock/config.json"
try:
  config = None
  with open(config_path) as db_config:
    config = json.load(config_path)
  local_db = MemberDatabase(sqlite3.connect(config["local_database"]))
  remote_db = MemberDatabase(mysql.connector.connect(**config["database"]))
  door_connection = DoorConnection(local_db, remote_db)
  Door(door_connection).run()
except FileNotFoundError:
  print("Config file must exist to start the RFID lock")
except IndexError:
  print("The JSON config file is missing information necessary to the RFID lock")

